# 3.2 Agent1

Agent 1 负责对用户设计的合理性评估，其目标是判断设计是否符合特定领域知识，并且在上下文中不存在明显的冲突。它基于领域的知识图和上下文的约束，对用户设计的逻辑一致性给出评分。

设用户的设计元素集合为 $D = \{ e_1, \cdots, e_n \}$。Agent 1 从以下两个维度对每个元素 $e_i$ 进行评估：函数 $\operatorname{Sim}(e_i, KG)$ 度量设计中的元素和知识图 $KG$ 的语义匹配度；函数 $\operatorname{Consistency}(e_i, C)$ 度量设计中的元素与上下文约束 $C$ 的满足程度。

将 $\operatorname{Sim}$ 与 $\operatorname{Consistency}$ 相乘得到单个元素的合理性得分。对所有元素的合理性得分取平均值，得到整个设计方案的合理性得分：

$$S_r(D) = \frac 1 {|D|} \sum_{i=1}^n \operatorname{Sim}(e_i, KG) \cdot \operatorname{Consistency}(e_i, C)$$

在本文的案例中，$\operatorname{Sim}$ 函数通过 Python 的第三方库 Clip 与模型 Deeplab 实现。Deeplab 首先将原始图片分割为若干语义一致的区域，然后 Clip 库计算出图片与对应文字的特征向量，并计算余弦相似度作为合理性得分。

```
Algorithm 1: Rationality Evaluation
Input: Design D, Knowledge Graph KG, Context C
Output: Rationality score S_r, Report R_r
1: Initialize S_r = 0
2: for each element e in D:
3:     match_score = SemanticMatch(e, KG)
4:     consist_score = ConstraintCheck(e, C)
5:     S_r += match_score * consist_score
6: end for
7: S_r = S_r / |D|
8: Generate R_r based on low-score elements
9: return S_r, R_r
```

# 3.3 Agent2

Agent 2 负责对用户设计的可行性进行评估。它综合考虑材料获取、制造工艺、成本控制等不同方面。

本文将可行性问题形式化为一组约束集 $\Phi = \{ \phi_1, \cdots, \phi_m \}$，每个约束 $\phi_j$ 对应一个指标值函数 $f_j$ 与阈值 $\tau_j$。$f_j(D)$ 计算设计方案 $D$ 在第 $j$ 个维度的表现；阈值 $\tau_j$ 刻画了该指标在当前工程条件下可接受的上限。当 $f_j(D) \le \tau_j$ 时，$\phi_j$ 被满足。

可行性得分 $S_f$ 被定义为约束满足情况的加权和：

$$S_f(D) = \sum_{j=1}^m w_j \cdot \mathbb I(f_j(D) \le \tau_j)$$

其中 $w_j$ 为权重，$\mathbb I$ 为指示函数，定义如下：

$$\mathbb I(P) = \begin{cases}
    1, & P \text{ is true} \\
    0, & P \text{ is false} \\
\end{cases}$$

Agent 2 在计算 $S_f$ 的同时，会报告所有被违反的约束组成的集合 $R_f = \{ \phi_j \mid f_j(D) > \tau_j \}$。该集合用于明确指出设计中在工程和资源层面的具体问题，为后续优化提供依据，且增强评估结果的可解释性。

```
Algorithm 2: Feasibility Evaluation
Input: Design D, Constraints Φ, Weights W
Output: Feasibility score S_f, Report R_f
1: Initialize S_f = 0
2: for each constraint φ in Φ:
3:     value = ComputeMetric(D, φ)
4:     if value ≤ φ.threshold:
5:         S_f += W[φ]
6:     end if
7: end for
8: Generate R_f highlighting violated constraints
9: return S_f, R_f
```

# 3.4 Agent3

Agent 3 负责对用户设计的风险进行评估，重点识别造成潜在负面影响的概率。由于设计中的风险来源往往多样，本文将风险划分为技术风险、市场风险和伦理风险三个维度，构成风险维度集：

$$\mathcal R = \{ tech, market, ethic \}$$

Agent 3 基于历史数据 $H$ 和仿真模型 $M$，对每一风险维度 $k \in \mathcal R$ 计算其发生概率 $P_k(D)$。历史数据用于识别长期趋势，仿真模型则用于模拟系统在特定假设场景下做出的反应。

由于任一风险发生都会导致系统失败，定义风险得分 $S_{\text{risk}}$ 为至少一个风险发生的概率：

$$S_{\text{risk}}(D) = 1 - \prod_{k \in \mathcal R} (1 - P_k(D))$$

Agent 3 在计算 $S_{\text{risk}}$ 的同时，会同时报告概率最高的风险因素 $R_{\text{risk}}$，为中央协调器在对方案进行取舍时提供依据。

```
Algorithm 3: Risk Evaluation
Input: Design D, Historical Data H, Simulation Model M
Output: Risk score S_risk, Report R_risk
1: Initialize P = []
2: for each risk dimension k in {tech, market, ethic}:
3:     prob = PredictRisk(D, H, M, k)
4:     P.append(prob)
5: end for
6: S_risk = 1 - ∏(1 - P)
7: Generate R_risk with top risk factors
8: return S_risk, R_risk
```