# 主要思想

对于一个要计数的 $g_i$，我们去考虑 $f_n = \sum_{i=0}^n \binom n i g_i$ 能不能快速求，若可以，则可以 $g_n = \sum_{i=0}^n (-1)^{n-i} \binom n i f_i$ 反推回来。

# 例：错排列

设长为 $i$ 的错排列有 $d_i$ 个。直接计数困难，考虑算

$$f_n = \sum_{i=0}^n \binom n i d_i$$

考虑组合意义，我们发现 $\binom n i d_i$ 就是 $i$ 个位置错误、 $n-i$ 个位置正确、长度为 $n$ 的排列的个数。求和得到总排列个数 $f_n = n!$。

反推：

$$d_n = \sum_{i=0}^n (-1)^{n-i} \binom n i f_i = \sum_{i=0}^n (-1)^{n-i} \binom n i i!$$

可以进一步化简为

$$n! \sum_{k=0}^n \frac {(-1)^k} {k!}$$

# 二项式反演推导

可以用指数生成函数 EGF 推导，优雅且自然：

$$\begin{aligned}
    f_n &= \sum_{i=0}^n \binom n i g_i \\
    \frac {f_n} {n!} &= \sum_{i=0}^n \frac{g_i} {i!} \frac 1 {(n-i)!} \\
    \hat F(x) &= \hat G(x) \times e^x \\
    \hat G(x) &= \hat F(x) \times e^{-x} \\
    \frac {g_n} {n!} &= \sum_{i=0}^n \frac{f_i} {i!} \frac {(-1)^{n-i}} {(n-i)!} \\
    g_n &= \sum_{i=0}^n (-1)^{n-i} \binom n i f_i \\
\end{aligned}$$

# 后缀二项式反演

这是前缀的反演，那么后缀的呢？我们可以构造“倒指数生成函数”（名字我乱起的）：

$$\begin{aligned}
    f_n &= \sum_{i=n}^\infty \binom i n g_i \\
    n! f_n &= \sum_{i=n}^\infty i! g_i \times \frac 1 {(n-i)!} \\
\end{aligned}$$

构造 $F(x) := \sum_{i=0}^\infty i! f_i x^i$，$G(x)$ 同理。

构造 $H(x) := \sum_{i=0}^\infty \frac 1 {i!} x^{-i} = e^{\frac 1 x}$。

$$\begin{aligned}
    G(x) &= \frac 1 {H(x)} F(x) = e^{-\frac 1 x} F(x) \\
    n! g_n &= \sum_{i=n}^\infty i! f_i \times \frac {(-1)^{n-i}} {(n-i)!} \\
    g_n &= \sum_{i=n}^\infty (-1)^{i-n} \binom i n f_i \\
\end{aligned}$$

其实差卷积应该都可以这样构造。