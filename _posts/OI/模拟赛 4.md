# 21 套（11.22）

[【MX-S12】梦熊 NOIP 2025 模拟赛 4（同步赛）](https://www.luogu.com.cn/contest/287515)

## [P14567 【MX-S12-T2】区间](https://www.luogu.com.cn/problem/P14567)

> 

### Sol 1 随机化

对于一种颜色出现的每个位置，随机赋权使得异或和为 $0$。

一个区间合法的**必要条件**为区间内异或和为 $0$。

TODO: 做法正确性还没想通。

### Sol2 Tarjan+线段树优化连边

选择颜色 $i$ 必须选择颜色 $j$，则连边 $i \to j$。

线段树优化建图，$O(n \log n)$

Tarjan 缩点。

### Sol3 Tarjan+栈

困难！

栈优化建图，$O(n)$

只新增栈顶的边

删除时设定懒标记，取栈顶元素时每次判断栈顶元素标记

TODO:

##

##

# 22 套（11.23）

[【LGR-250】洛谷 NOIP 2025 模拟赛](https://www.luogu.com.cn/contest/289075#problems)

## [P14507 缺零分治 mexdnc](https://www.luogu.com.cn/problem/P14507) (Easy)

> TODO:

TODO:

## [P14508 猜数游戏 guess](https://www.luogu.com.cn/problem/P14508)✅️ (Hard)

> 在无限长的整数格线上，起点在 $ 1 $，已知目标格在 $[1, n]$ 中。
> 有 $ m $ 种移动方式，每种方式可以花费 $ b_i $ 向左或向右移动 $ a_i $ 格。
> 每次移动会检测经过的区间（**左闭右开**）是否包含目标，并返回是/否。
> 你可以根据检测结果自适应选择后续移动。
> 问：在最坏情况下，确定目标位置所需的最小总花费是多少？若不可能确定，输出 $-1$。
>
> $n \le 10^4$，$m \le 10^3$，$a_i \le \min(n, 10^3)$。

首先发现长度为 $i$ 的问题在走一步（长度为 $j$）之后会变成 $j$ 和 $i-j$ 的两个子问题。设走这一步需要花费 $c_j$，则可以列出（并不完善的）DP 方程：

$$f_i = \min\limits_{j} (\max(f_j, f_{i-j}) + c_j)$$

但是我们发现这无法处理出区间了之后再回来的情况。若我们将 $c$ 的定义扩充到 $c_j$ 表示走若干步后等价于走 $j$ 格的最小费用，即可完善 DP 方程：

$$f_i = \min\limits_{j=1}^{i-1} (\max(f_j, f_{i-j}) + c_j)$$

怎么求出所有的 $c$？**最短路**。

具体地，对于每一个位置 $u$ 和每一个操作 $i$，我们连边 $u \xrightarrow{b_i} (u + a_i)$ 和 $u \xrightarrow{b_i} (u - a_i)$，然后跑 Dijkstra 即可。

但是位置 $u$ 的数量看起来非常爆炸，似乎会达到很大以至于复杂度爆掉。真的是这样吗？

### 先来看另一个题目

> [P9207 灭罪「正直者之死」](https://www.luogu.com.cn/problem/P9207)
>
> 给定一个区间 $[-2^{k-1}, 2^{k-1})$。给定一堆该区间内的数 $a_{[1,n]}$。
>
> 我希望重排 $a$，使得 $a$ 的前 $K$ 个前缀和 $S_{[1,K]}$ 都落在该区间之内。最大化 $K$ 并输出。
>
> 需要 $O(n \log n)$ 的时间复杂度。

**结论**：若一列数的值域在 $[L,R]$ 内，且它们的和也在 $[L,R]$ 内，则必定存在一种排列方式，使得每一个前缀和（除了第一个 $S_0 = 0$ 以外）都落在 $[L,R]$ 内。

首先 $[L,R]$ 不经过 $0$ 的情况下，该结论平凡，因此我们只考虑 $L < 0 < R$ 的情况。

考虑目前的前缀和 $S_x$，接下来我要决定下一个位置 $a_{x+1}$ 放哪个数。

若 $S_x < 0$，则在 $a_{x+1}$ 放一个正数一定是一个稳妥的选择，不可能爆掉；反之 $S_x > 0$ 时放一个负数即可。

但是，若 $S_x < 0$ 且正数用完了怎么办？无脑放负数即可，因为最低也就到 $\sum_{i=1}^n a_i$，而命题保证了这个和也在区间内。同理 $S_x > 0$ 且负数用完了也可以无脑放。

---

对于这个题目来说，我们先计算总和 $\sum_{i=1}^n a_i$：
- 如果落在区间里了，则答案直接是 $n$；
- 如果落在 $< -2^{k-1}$，则我们不断扔掉最小的负数，直到总和落在区间内；
- 如果落在 $\ge 2^{k-1}$，则我们不断扔掉最大的正数，直到总和落在区间内。

因为需要排序，时间复杂度 $O(n \log n)$。

### 回到本题

设 $V = \max a_i$。

每一个步数都在 $[-V, V]$ 之间，而最终目的地也在 $[-V, V]$ 之间，因此根据上面的结论，中途的每个目的地也必定在 $[-V, V]$ 之间。

因此，我们只需要考虑 $[-V, V]$ 之间的位置即可，这样就限制在了 $O(V)$。

具体实现的时候，为了方便，可以把目的地范围改成 $[0, 2V]$，不难发现本质相同。

$$f_i = \min\limits_{j=1}^{\min(i-1, 2V)} (\max(f_j, f_{i-j}) + c_j)$$

稠密图 Dijkstra 时间复杂度 $O(V^2 + mV)$，DP 时间复杂度 $O(n \min(n, V))$。

单组数据时间复杂度 $O(V^2 + mV + n \min(n, V))$。

## [P14509 树上求值 tree](https://www.luogu.com.cn/problem/P14509) (Hard)

> TODO:

**题目的整体动机**：$f$ 函数需要拆位，对应的数据结构应该是 01Trie；与此同时，在遍历树的时候，$d$ 项的变化永远是 $\pm 1$，考虑反 Trie。

---

枚举 LCA。TODO:

假设我们已经有了 $fa_u$ 的信息，现在我们想爬到儿子处的 $u$。

设 $T_u$ 为 $u$ 的子树。

$$\begin{aligned}
    & \sum_{v \in T_{fa_u}} f(v + d_{\text{LCA}(v,fa_u)}) \\
    =& \sum_{v \in T_u} f(v + d_{\text{LCA}(v,fa_u)}) + \sum_{v \in T_{fa_u} \land v \not \in T_u} f(v + d_{\text{LCA}(v,fa_u)}) \\
    =& \sum_{v \in T_u} f(v + d_{\text{LCA}(v,u)} - 1) + \sum_{v \in T_{fa_u} \land v \not \in T_u} f(v + d_{\text{LCA}(v,u)}) \\
\end{aligned}$$

因此我们维护两个东西，分别是

$$\sum_{v \in T_u} f(v + d_{\text{LCA}(v,u)})$$

和

$$\sum_{v \in T_u} f(v + d_{\text{LCA}(v,u)} - 1)$$

此时变成一道 DS 题。我们的 DS 要能支持以下操作：
- 维护一个可重集 $S$。
- 查询 $\sum_{x \in S} f(x)$。
- 把 $S$ 内所有数 $-1$。

TODO:

## [P14510 夜里亦始终想念着你 miss](https://www.luogu.com.cn/problem/P14510)

> TODO:

### 暴力的 12pts 打法

首先暴搜搜出所有可能的棋盘状态（状压），统计子集用**高维后缀和**，时间复杂度 $O(q \times n 2^n)$。

具体来说，设 `vis[u]` 表示状态 $u$ 被暴搜到了，那么统计可以这么写：

```cpp
rep(i, 0, n-1)
    rep(u, 0, tot)
        if (!(u >> i & 1))
            vis[u] |= vis[u ^ (1 << i)];
```

### 正解

TODO:

把所有 $0$ 尽量往左移。

从左到右考虑 $S$ 里的每个限制，冲突了就把这个 $0$ 和后面所有 $0$ 都向右平移两格。到最终若没有 $0$ 出去了，则 $S$ 合法。

我们只关心最后一个 $0$ 的移动。设原本的位置为 $p$，则最多移动 $\lfloor \frac {n-p} 2 \rfloor$ 次。记总共有 $c$ 个 $0$。

移动 $i$ 次，固定了 $i$ 个

$n-c-i$ 个任意

$$\sum_{j=1}^c x_j = i, x_j \ge 0$$

插板法：

$$\binom {c+i-1} {c-1}$$

总方案数：

$$\sum_{i=0}^{\lfloor \frac {n-p} 2 \rfloor} 2^{n-c-i} \binom {c+i-1} {c-1}$$

$$F(m,k) =\sum_{i=0}^m 2^{n-k-i} \binom {k+i-1} {k-1}$$

每次 $m,k$ 都只会走一步，类似高桥君去做。

TODO:

# Ad-hoc 特辑

## [P9591 「PFLOI R1」PFL 变换](https://www.luogu.com.cn/problem/P9591) (Ad-hoc)

略。

## [CF1720E Misha and Paintings](https://www.luogu.com.cn/problem/CF1720E) (Ad-hoc)

打表 0/1/2

$0$ 简单，$1$ 直接 $O(n^3)$ 做，都不对就是 $2$

## [CF1515F Phoenix and Earthquake](https://www.luogu.com.cn/problem/CF1515F) (Easy)

> TODO:

$$\sum a_i \ge (n-1) x$$

TODO:

## [AT_arc122_e [ARC122E] Increasing LCMs](https://www.luogu.com.cn/problem/AT_arc122_e) (Easy)

倒推

TODO:

## [P7597 「EZEC-8」猜树 加强版](https://www.luogu.com.cn/problem/P7597) (Ad-hoc, Hard)

重链剖分，期望 $O(n \log n)$

随机 $a$ 个点，用 1 操作判断是否在子树内，令最多的那个是重儿子

$a=1$ 效果良好，考虑证明


分析错误轻重边

$siz_{fa_u}$ 和 $2 siz_u$ 的大小关系，讨论

TODO:

## [CF1364D Ehab's Last Corollary](https://www.luogu.com.cn/problem/CF1364D) (Ad-hoc)

经典老问题

TODO:


## [CF1270G Subset with Zero Sum](https://www.luogu.com.cn/problem/CF1270G) (Ad-hoc, Normal)

优雅

TODO:

## [P10299 [CCC 2024 S5] Chocolate Bar Partition](https://www.luogu.com.cn/problem/P10299) (Hard)

贪心还是 DP？不像贪心。

平均数套路：减掉平均数，和为 $0$

浮点数？没事，$\times 2n$ 再做

$f_{i, x, y}$，$O(n^3 V^2)$

---

$x + y = s_i$，少掉 $y$，$O(n^2 V)$

---

**增大转移复杂度减少状态**

枚举下标 $j$ 转移，只有拼出 $0$ 的状态才有意义

要么 $x=0$ 要么 $y=0$。

- $x,y$ 在同一连通块，都是 $0$
- $x$ 凑出 $0$ 了
- $y$ 凑出 $0$ 了

---

$j$ 也不用枚举，哈希表

## [CF1789F Serval and Brain Power](https://www.luogu.com.cn/problem/CF1789F) (Ad-hoc)




## [CF1364E X-OR](https://www.luogu.com.cn/problem/CF1364E) (Ad-hoc)

固定 $i$ 时，随机 $k$ 个 $j$，把结果 and 在一起就是 $p_i$，错误率 $\frac 1 {2^k}$。

$2n + \log^2 n$

$2n + \log n \log \log n$？TODO: