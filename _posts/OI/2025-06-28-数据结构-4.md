---
title: '数据结构 4'
date: 2025-06-28
permalink: /posts/2025/06/2025-06-28-数据结构-4/
excerpt: "数据结构"
tags:
  - OI
---

# 可持久化

## 标记永久化

不下传标记，只在查询的时候考虑。

## Path Copy

线段树、Trie、左偏树、无旋 Treap

注意到无旋 Treap 每次修改 $\log$ 个点，path copy

# 例题

## [P5283 [十二省联考 2019] 异或粽子](https://www.luogu.com.cn/problem/P5283)

$O((n+k) \log V)$

### 可持久化做法

TODO:

### 无可持久化做法

[](https://www.luogu.com.cn/article/ipa5pxaj)

TODO:

## [P5283 [十二省联考 2019] 异或粽子](https://www.luogu.com.cn/problem/P5283)【$k$ 无限制】

用二分求第 $k$ 大

TODO:

$\sum\limits_{v \in S} (v \oplus s_i)$，拆位维护 $\Theta(\log V)$ 个前缀和

$O(n \log^2 V)$

## [P3402 可持久化并查集](https://www.luogu.com.cn/problem/P3402)

不能路径压缩（均摊复杂度，错的）。

启发式合并，用可持久化数组维护 $fa$ 和 $siz$。$O(n \log^2 n)$。

## [BZOJ4668 冷战](https://hydro.ac/p/bzoj-P4668)

神题。

我想的：倍增 + LCA，时间 1log，空间 1log

**Trick** TODO:

## [P3295 [SCOI2016] 萌萌哒](https://www.luogu.com.cn/problem/P3295) (Hard)

> 给定序列长度 $n$。你不知道序列具体元素，但是你知道 $m$ 个关系，每个关系形如：$[l_1, r_1]$ 与 $[l_2, r_2]$ 两个区间内的元素完全相同。
>
> 求出最后序列中最多有几个不同元素。
>
> $1 \le n,m \le 10^5$。

神题。这个题可以作为“倍增并查集”的模板题。

我们考虑类似优化建图的想法。首先线段树优化是不优的，因为**区间相同是可叠加的，因此使用 ST 表的结构**。

我们建立 $O(\log n)$ 层。第 $i$ 层第 $j$ 个节点 $x_{i,j}$ 代表区间 $[j, j + 2^i)$。

对于每个关系，我们求出 $i = \lfloor \log_2 (len) \rfloor$，拆成 $x_{i,l_1} = x_{i,l_2}$ 和 $x_{i,r_1-2^i+1} = x_{i,r_2-2^i+1}$。

最终统计时，我们根据第 $i$ 层的并查集结构更新 $i-1$ 层的并查集。

若 $x_{i,u} = x_{i,v}$，则我们在 $i-1$ 层建立 $x_{i-1,u} = x_{i-1,v}$ 和 $x_{i-1,u+2^{i-1}} = x_{i-1,v+2^{i-1}}$。

具体实现是：枚举 $u$，找到其并查集的最高点 $v = \text{find}_{i}(u)$，在 $u,v$ 之间做刚才说的操作。而不是在每一对 $x_{i,u} = x_{i,v}$ 之间做。

最终第 $0$ 层就是真实的并查集，直接统计即可。

## [#14. 【UER #1】DZY Loves Graph](https://uoj.ac/problem/14)

**Trick** 离线 & 撤销的不是撤销 -> 势能分析

TODO:

# 可并堆

平衡树可以完全覆盖可并堆的功能……但是可并堆常数小。

[P3377 【模板】左偏树/可并堆](https://www.luogu.com.cn/problem/P3377)

TODO:

# 可持久化无旋 Treap

无旋 Treap：随机权满足堆的性质，权满足 BST 的性质



TODO:

## [P5055 【模板】可持久化文艺平衡树](https://www.luogu.com.cn/problem/P5055)

模板题。

TODO: