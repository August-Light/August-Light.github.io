# 必胜态和必败态

- 没有后继的是必败态
- 必胜态的后继中至少有一个必败态
- 必败态的后继全是必胜态

# Nim 游戏

[P2197 【模板】Nim 游戏](https://www.luogu.com.cn/problem/P2197)

必败的充要条件：

$$\bigoplus a_i = 0$$

## 构造性证明

TODO:

# SG 函数

$$SG(u) = \operatorname{mex}\limits_{u \to v} SG(v)$$

边界情况，若 $u$ 的后继为 $\varnothing$，即 $u$ 无法行动，则 $SG(u) = 0$。

## 简单推论

$u$ 是必败态当且仅当 $SG(u) = 0$。

## SG 定理

我有若干个游戏 $G_i$ 一起玩，所有游戏都无法操作的人输。

必败的充要条件：

$$\bigoplus SG(G_i) = 0$$

### 证明

$\forall u$，$\forall x \in [0, SG(u))$，必定存在 $u \to v$ 使得 $SG(v) = x$。

因此就是对 $SG$ 玩 Nim 游戏。

# Anti 游戏

不可操作者赢。

【模板】Anti-Nim 游戏：[P4279 [SHOI2008] 小约翰的游戏](https://www.luogu.com.cn/problem/P4279)

- 若 $\max SG(G_i) \le 1$，先手必胜当且仅当 $\bigoplus SG(G_i) = 0$。
- 否则，先手必胜当且仅当 $\bigoplus SG(G_i) \ne 0$。

总之，除了所有 $SG \le 1$ 的情况，剩下还是和原来一样的。

## 构造性证明

TODO:

# 例题

## 不显然的独立游戏：[P3185 [HNOI2007] 分裂游戏](https://www.luogu.com.cn/problem/P3185)

> TODO:

每一颗豆子是独立游戏

$$SG(i) = \operatorname{mex}_{i < j \le k} (SG(j) \oplus SG(k))$$

## 特殊的 $SG$ 边界条件：BZOJ1457 棋盘游戏

> TODO:

每一个皇后是独立游戏，但是结束条件和往常不同

只能到达【能走到 $(0,0)$ 的点】的点是必败态，把 $SG$ 设为 $0$。

## 优化 $SG$ 转移：[P3235 [HNOI2014] 江南乐](https://www.luogu.com.cn/problem/P3235)

$$\begin{aligned}
    SG(x) = \operatorname{mex}_{m=2}^x ( & \\
    & [2 \nmid (m - x \bmod m)]SG(\lfloor \frac x m \rfloor) \\
    & \oplus [2 \nmid (x \bmod m)] SG(\lfloor \frac x m \rfloor + 1) \\
    )
\end{aligned}$$

$\lfloor \frac x m \rfloor$ 显然可以数论分块，加个奇偶性的分讨，$O(n + V \sqrt V)$。

可以杜教筛。TODO:

## [[AGC017D] Game on Tree](https://www.luogu.com.cn/problem/AT_agc017_d)

TODO: 两种游戏，含不含根节点，互相转移

## 非常抽象的规律：[HDU4664 Triangulation](https://vjudge.net/problem/HDU-4664)

$$SG(n) = \operatorname{mex}_{i=3}^{n-1} (SG(i) \oplus SG(n-i+2))$$

$n > 68$ 后有长度为 $34$ 的循环节。

或许和 [CF1704F Colouring Game](https://www.luogu.com.cn/problem/CF1704F) 冥冥之中有什么联系。

## Game of Stones

> TODO:
>
> e.g. 我在第 $3$ 堆取了 $5$ 颗，则下一次他不能在第 $3$ 堆取 $5$ 颗。

$SG(x) = \arg \max_n \sum_{i=1}^n i \le x$

## 状态压缩记忆化搜索：[CF850C Arpa and a game with Mojtaba](https://www.luogu.com.cn/problem/CF850C)

**非连续转移，可能可以记忆化搜索**。

> TODO:

每个质数独立

去重，压成二进制数，记忆化搜索


# 杂题

## 后手复制操作：HDU3951 Coin game

TODO:

## HDU2486

> $n$ 个石子。**先手第一次操作**可以取 $[1, n-1]$，接下来从后手开始轮流取，每个人可以取的石子数必须不超过上一人取的 $k$ 倍。不能操作者输。
>
> $n \le 10^8$，$k \le 10^5$。



TODO:

### $k=1$



### $k=2$

Fibonacci 编码

贪心

### 任意 $k$

TODO:

## [[AGC002E] Candy Piles](https://www.luogu.com.cn/problem/AT_agc002_e)

<img src="https://s2.ax1x.com/2019/10/13/uxC5ND.png" width=200/>
<img src="https://s2.ax1x.com/2019/10/13/uxiGyn.png" width=200/>

<img src="https://s2.ax1x.com/2019/10/13/uxite0.png" width=200/>

<img src="https://s2.ax1x.com/2019/10/13/uxiNwV.png" width=400/>