# COW Traversals

> 给定一棵 $n$ 个点的内向基环树（每个点出度为 $1$），每个节点初始时都没有颜色。颜色共有 $3$ 种，分别为 `C`,`O`,`W`。
>
> 定义点 $u$ 的目的地 $p_u$ 为从 $u$ 开始走会遇到的第一个有颜色节点。目的地可能不存在。
>
> 有 $m$ 次修改，每次修改选择一个节点 $u$ 并将其染上颜色 $k$（若已经被染色过，则覆盖原本的颜色）。每次修改后，分别求出目的地颜色为 `C`,`O`,`W` 的点的数量。
>
> $n,m \le 2 \times 10^5$。

感觉是下位绿题。

时光倒流，路径压缩 DSU。

$n,m$ 同阶，时间复杂度 $O(n \log n)$。

# Milk Buckets

> 给定一个长为 $n$ 的数组 $a$。
>
> 你可以执行若干次操作，每次操作是交换相邻的两个数。
>
> 在全部交换完成后，你要执行 $n-1$ 次另一种操作：选择两个相邻数 $a_i, a_{i+1}$，把这两个数替换为一个数 $\frac {a_i + a_{i+1}} 2$。最终整个序列只剩一个数 $C$。
>
> 你希望在最大化 $C$ 的前提下，最小化交换次数。输出交换次数。
>
> $n \le 2 \times 10^5$。

感觉是上位绿题。

首先根据排序不等式发现贪心策略是每次合并最小的两个数。

不难证明原序列单谷是贪心可以成立的充要条件。

原问题等价于：用最少交换次数把 $a$ 排成单谷。发现就是 [Gym 102082G What Goes Up Must Come Down](https://vjudge.net/problem/Gym-102082G)。

[解法](https://www.cnblogs.com/asdfsag/p/11394132.html)，用 BIT 在 $O(n \log n)$ 时间内解决。

# Supervision

> 给定 $n$ 个区间 $[L_i, R_i]$，保证区间之间没有包含关系，即 $L,R$ 单调弱增。求
>
> $$\sum_{S \in \{1, \cdots, n\}} \text{pow}\left( 2, {\left\lvert \bigcup_{i \in S} [L_i, R_i]\right\rvert} \right)$$
>
> （防歧义：$\lvert S \rvert$ 指的是 $S$ 中的整数个数。）
>
> $n \le 10^6$，值域 $\le n$。答案对 $10^9 + 7$ 取模。

感觉是中位紫题。

TODO: 咋做？？